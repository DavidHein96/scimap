# ü•∑ Getting started with SCIMAP


```python
# import scimap
import scimap as sm
```

    Running SCIMAP  1.3.12


The sample data provided is generated by the mcmicro pipeline. Let's begin by exploring how to seamlessly import mcmicro pipeline output into Scimap with a straightforward single-line command.

In this section of the tutorial, we'll be working with the single-cell data you've obtained, located within the directory "scimapExampleData/quantification". This dataset is rich with information, encompassing not just the expressions of various markers in individual cells but also valuable metadata such as XY coordinates and cell sizes. 


```python
# Provide the path to the single-cell feature table. Note that you can specify multiple paths as a list.
feature_table_path = ["/Users/aj/Dropbox (Partners HealthCare)/nirmal lab/resources/exemplarData/scimapExampleData/quantification/exemplar-001--unmicst_cell.csv"]

# create the annData object
adata = sm.pp.mcmicro_to_scimap(feature_table_path)
```

    Loading exemplar-001--unmicst_cell.csv


## Exploring contents of the annData object


```python
adata

# The dataset contains 11201 cells and 9 markers
# The obs sections contains the meta data related to each cell
```




    AnnData object with n_obs √ó n_vars = 11201 √ó 9
        obs: 'X_centroid', 'Y_centroid', 'Area', 'MajorAxisLength', 'MinorAxisLength', 'Eccentricity', 'Solidity', 'Extent', 'Orientation', 'CellID', 'imageid'
        uns: 'all_markers'
        layers: 'log'




```python
# print the contents of the expression matrix. 
# By default on import, scimap applies a log transformation, you could set `log=False` if it is already log transformed
adata.X
```




    array([[7.0737187 , 5.09012558, 6.56401223, ..., 6.56296306, 5.32982432,
            6.75017136],
           [7.02618545, 5.1830041 , 6.67364145, ..., 6.93618427, 5.96229317,
            6.80626408],
           [7.13129875, 5.06030083, 6.67480083, ..., 7.19693192, 5.66577023,
            6.8434742 ],
           ...,
           [7.07756235, 5.31643791, 6.67671156, ..., 6.89449634, 5.64170442,
            6.80208784],
           [6.90256944, 5.31600484, 6.31401645, ..., 6.7339149 , 5.45318208,
            6.77120455],
           [7.06054074, 5.45066285, 6.32567977, ..., 6.34348493, 5.14151735,
            6.73978032]])




```python
# print metadata
adata.obs
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X_centroid</th>
      <th>Y_centroid</th>
      <th>Area</th>
      <th>MajorAxisLength</th>
      <th>MinorAxisLength</th>
      <th>Eccentricity</th>
      <th>Solidity</th>
      <th>Extent</th>
      <th>Orientation</th>
      <th>CellID</th>
      <th>imageid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>exemplar-001--unmicst_cell_1</th>
      <td>1767.692308</td>
      <td>257.290598</td>
      <td>117</td>
      <td>12.402944</td>
      <td>12.006487</td>
      <td>0.250814</td>
      <td>0.959016</td>
      <td>0.812500</td>
      <td>-1.146733</td>
      <td>1</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_2</th>
      <td>1107.173913</td>
      <td>665.869565</td>
      <td>92</td>
      <td>11.874070</td>
      <td>9.982065</td>
      <td>0.541562</td>
      <td>0.948454</td>
      <td>0.696970</td>
      <td>-0.435290</td>
      <td>2</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_3</th>
      <td>1116.413793</td>
      <td>671.068966</td>
      <td>58</td>
      <td>10.113305</td>
      <td>7.629922</td>
      <td>0.656364</td>
      <td>0.878788</td>
      <td>0.585859</td>
      <td>1.221658</td>
      <td>3</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_4</th>
      <td>982.728625</td>
      <td>677.029740</td>
      <td>269</td>
      <td>25.433196</td>
      <td>15.183300</td>
      <td>0.802251</td>
      <td>0.835404</td>
      <td>0.531621</td>
      <td>-0.705293</td>
      <td>4</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_5</th>
      <td>1141.071078</td>
      <td>680.125000</td>
      <td>408</td>
      <td>26.604670</td>
      <td>19.759781</td>
      <td>0.669604</td>
      <td>0.937931</td>
      <td>0.739130</td>
      <td>-0.711002</td>
      <td>5</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_11197</th>
      <td>1270.593750</td>
      <td>3131.731250</td>
      <td>160</td>
      <td>19.414487</td>
      <td>11.039993</td>
      <td>0.822582</td>
      <td>0.893855</td>
      <td>0.701754</td>
      <td>-1.364872</td>
      <td>11197</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_11198</th>
      <td>1177.349057</td>
      <td>3130.839623</td>
      <td>106</td>
      <td>14.080819</td>
      <td>10.062622</td>
      <td>0.699499</td>
      <td>0.876033</td>
      <td>0.706667</td>
      <td>1.478579</td>
      <td>11198</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_11199</th>
      <td>1255.904762</td>
      <td>3131.285714</td>
      <td>105</td>
      <td>15.623503</td>
      <td>9.143181</td>
      <td>0.810875</td>
      <td>0.882353</td>
      <td>0.596591</td>
      <td>-1.065479</td>
      <td>11199</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_11200</th>
      <td>1354.448276</td>
      <td>3131.810345</td>
      <td>58</td>
      <td>9.779089</td>
      <td>7.836216</td>
      <td>0.598231</td>
      <td>0.878788</td>
      <td>0.725000</td>
      <td>-1.072712</td>
      <td>11200</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
    <tr>
      <th>exemplar-001--unmicst_cell_11201</th>
      <td>1125.662500</td>
      <td>3133.100000</td>
      <td>80</td>
      <td>14.311249</td>
      <td>7.225347</td>
      <td>0.863194</td>
      <td>0.941176</td>
      <td>0.714286</td>
      <td>1.370610</td>
      <td>11201</td>
      <td>exemplar-001--unmicst_cell</td>
    </tr>
  </tbody>
</table>
<p>11201 rows √ó 11 columns</p>
</div>




```python
# lastly lets print the markers
adata.var
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ELANE</th>
    </tr>
    <tr>
      <th>CD57</th>
    </tr>
    <tr>
      <th>CD45</th>
    </tr>
    <tr>
      <th>CD11B</th>
    </tr>
    <tr>
      <th>SMA</th>
    </tr>
    <tr>
      <th>CD16</th>
    </tr>
    <tr>
      <th>ECAD</th>
    </tr>
    <tr>
      <th>FOXP3</th>
    </tr>
    <tr>
      <th>NCAM</th>
    </tr>
  </tbody>
</table>
</div>



Upon inspection, you will note the following characteristics about the data: it has undergone log transformation, is devoid of DNA channels, and lacks background channels. By default, the data has been processed to address key considerations: it has been log-transformed, DNA channels have been removed, and background channels have been excluded. However, these preprocessing steps can be customized or overridden as needed.

<hr>

## üßê What if your data was not generated using the MCMICRO pipeline?

If you're working with data not produced by mcmicro, it's crucial to consult the documentation for each function used in this series of tutorials. Each function operates under specific assumptions about its parameters. For instance, all spatial functions assume that XY coordinates are located in the 'X_centroid' and 'Y_centroid' columns. If your dataset organizes this information differently, you'll need to specify your column names when running the function.


```python
# import packages
import anndata as ad
import pandas as pd
```

After importing the necessary packages, you can create an AnnData object as shown below.

```
# Load data
data = pd.read_csv ('path/to/counts_table.csv') # Counts matrix
meta = pd.read_csv ('path/to/meta_data.csv') # Meta data like x and y coordinates 

# combine the data and metadata file to generate the AnnData object
adata = ad.AnnData (data)
adata.obs = meta

```

When manually importing data without using the built-in function that automates the process, it is crucial to follow four essential steps to ensure compatibility and effective data management for further analysis:

1. **Ensure Unique Image Identification**: Incorporate a column named `imageid` within the metadata to assign a unique identifier to each image, especially when handling datasets comprising multiple images. This facilitates the organization and retrieval of specific image data within a larger dataset.
   
2. **Preserve Raw Data**: Store the unprocessed raw data in `adata.raw`. This practice retains the original state of the data for reference or baseline comparisons before any preprocessing steps are applied.

3. **Log Transformation Layer**: Generate a layer named `log` to hold log-transformed data. Log transformation is a critical step for normalizing data and mitigating the impact of large-scale differences across measurements, enhancing the analysis's robustness and interpretability.

4. **Marker Annotation**: Maintain a record of all markers present in the images, ensuring their order matches the layers within the image data. This annotation is instrumental when loading images to precisely identify which layer corresponds to each marker, thus streamlining the analysis process by clarifying the relationship between image layers and their respective biological markers.

By adhering to these guidelines, researchers can ensure their manually imported datasets are well-organized and primed for comprehensive analysis, leveraging the full capabilities of their analytical platforms.


```python
# preserve raw data
adata.raw = adata

# log transform data
adata = sm.pp.log1p(adata)

# Add marker annotation
adata.uns['all_markers'] = ['list', 'of', 'markers']
```

<hr>

## Save the annData object

Once the AnnData object is created, it becomes the central data structure for all subsequent analyses. This is highly beneficial because it encapsulates all results within the object, eliminating the need to manage multiple related files. You can conveniently share this single file with collaborators, allowing them to continue the analysis seamlessly or resume from where you left off. Furthermore, numerous single-cell analysis tools, such as Scanpy, are built upon this framework. This integration allows for the straightforward application of functions from various packages without the necessity of data reformatting to suit each tool's specific requirements.


```python
# Save the results
adata.write('/Users/aj/Dropbox (Partners HealthCare)/nirmal lab/resources/exemplarData/scimapExampleData/scimapExampleData.h5ad')
```


```python

```


```python

```
